# 回転しない寿司のシステム構成


## 材料
 * M5StickC(M5Stack)
 * RoverC (M5Stack)
 * Optical Tracking Odometry Sensor (SparkFun)
 * 寿司 (コンビニ)
 * お皿とプレート

## システムについて：

- **M5StickC**：
 ![](/pic/d1a00c77-57de-40c9-ab9d-5ff7d219c633.png)
  - 制御用のマイクロコントローラーです。
  - Optical Tracking Odometry Sensor からの位置と角度の情報をリアルタイムに読み取って、RoverCの４つのモータの回転方向と速度を算出し、RoverCへ制御の指令を出します。
  - センサーとM5StickC、RovoerCとM5StickCとはそれぞれI2C信号で接続しています。

- **RoverC**：

![](/pic/1b954e6f-80fd-4ce8-ad05-e3a13e727b2c.png)
-   寿司を運搬するロボットです。モータと直結したメカナムホイールを４個搭載しています。メカナムホイールの回転方向と速度を制御することで、お寿司の回転を防ぎつつ、お寿司を平行移動する動作を実現しています。
　　
- **Optical Tracking Odometry Sensor**：

![](/pic/6106993e-cab4-47b6-ba24-98010949ea00.png)


  画像センサとIMUを内蔵した赤いセンサーです。ロボットの位置と角度をリアルタイムに検知し、M5StackやM5StickCへI2C通信で送信することができます。
  - 画像センサでテーブルの表面の模様から、移動速度を測定します。移動速度を積分してロボットのいる位置を求めることができます。
  - IMU（慣性計測ユニット）のジャイロセンサーで角速度を測定します。ジャイロセンサーの角速度を積分することで、ロボットの向いている角度を求めることができます。

## データフロー

![](/pic/89da99f4-46d1-46c4-97ce-afe0f5232f06.png)

こちらは、システム動作中のデータフローを示しています。
M5StickCコントローラはOptical Tracking Odometry Sensorから位置と角度のデータ(x,y,θ)を受信し、回転しないように制約を設けたうえで、選択された動作パターンに基づいて４つのモーター回転速度を計算し、RoverCに４つのモータの指令値コマンドを送信します。
このフィードバック制御によって、リアルタイムに回転しないお寿司の走行制御を実現します。


### 注記：出された寿司は早めに食べてあげましょう
お寿司の位置と角度を高精度で測定できるセンサーを積んではいますが、高精度なセンサーであっても、長い時間たつと、だんだんと誤差が積み重なってしまいます。ロボットにお寿司を載せて走っていると、少しずつズレてしまうんですね。

とはいっても、長い時間が経ってしまうと、お寿司のうまみが逃げてしまいます！！
出されたお寿司は早めに食べてあげましょう。
